---
import type { GetStaticPaths } from "astro";
import FilesLister from "@/components/files_lister.astro"
import Baselayout from "@/layouts/Baselayout.astro"
import { db } from "astro:db";
import { PYQs } from "astro:db";
import { and } from "astro:db";
import { eq } from "astro:db";
import type { ExplorerItem } from "@/types";
import ExplorerLayout from "@/layouts/ExplorerLayout.astro";

export const getStaticPaths = (async () => {
  const res = await db.selectDistinct({college_name: PYQs.college_short_name ,couse_name: PYQs.course_name, semester: PYQs.semester}).from(PYQs)
  
  return res.map(item=> ({ params: { college: item.college_name, course: item.couse_name.replaceAll(" ", "_"), semester: item.semester } }) );
}) satisfies GetStaticPaths;


const {college, course, semester } = Astro.params

const res = await db.selectDistinct({subject: PYQs.subject_short_name}).from(PYQs).where(and(eq(PYQs.college_short_name, college), eq(PYQs.course_name, course.replaceAll("_", " ")), eq(PYQs.semester, semester) ))

const subjects: ExplorerItem[] = res.map(item => ( { label: item.subject, link: item.subject, type: "folder" } ) ) 


---
<ExplorerLayout label="Subjects">
  <FilesLister items={subjects} />
</ExplorerLayout>
